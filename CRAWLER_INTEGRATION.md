# AI çˆ¬è™«åŠ©æ‰‹ä¸çˆ¬è™«ç®¡ç†æ•´åˆè¯´æ˜

## ğŸ“Š æ•´åˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·ç•Œé¢å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   AI çˆ¬è™«åŠ©æ‰‹          â”‚      çˆ¬è™«ç®¡ç†                     â”‚
â”‚   (crawler-assistant) â”‚      (crawler)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å¯¹è¯å¼åˆ›å»ºæ¨¡æ¿       â”‚ â€¢ æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿                    â”‚
â”‚ â€¢ AI åˆ†æé€‰æ‹©å™¨        â”‚ â€¢ æ‰§è¡Œæ‰‹åŠ¨æŠ“å–                    â”‚
â”‚ â€¢ å®æ—¶é¢„è§ˆæ•ˆæœ         â”‚ â€¢ é…ç½®å®šæ—¶ä»»åŠ¡                    â”‚
â”‚ â€¢ ä¿å­˜åˆ°æ¨¡æ¿åº“         â”‚ â€¢ æŸ¥çœ‹å†å²è®°å½•                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ crawlerAssistant     â”‚      crawlerService              â”‚
â”‚ Service              â”‚      (ç°æœ‰æœåŠ¡)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ AI åˆ†æç½‘é¡µç»“æ„     â”‚ â€¢ æ¨¡æ¿ CRUD æ“ä½œ                 â”‚
â”‚ â€¢ ç”Ÿæˆ CSS é€‰æ‹©å™¨     â”‚ â€¢ å®šæ—¶ä»»åŠ¡è°ƒåº¦                    â”‚
â”‚ â€¢ é¢„è§ˆæŠ“å–æ•ˆæœ        â”‚ â€¢ æ•°æ®æŒä¹…åŒ– (EAV)                â”‚
â”‚ â€¢ è°ƒç”¨ crawlerServiceâ”‚ â€¢ å†å²æ•°æ®æŸ¥è¯¢                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Python å¼•æ“                            â”‚
â”‚              (engine.py - å®é™…æ‰§è¡Œçˆ¬å–)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å•ä¸€æ•°æ®æº**ï¼šä¸¤ä¸ªé¡µé¢å…±äº« `crawler_templates` è¡¨
2. **èŒè´£åˆ†ç¦»**ï¼š
   - AI çˆ¬è™«åŠ©æ‰‹ï¼šä¸“æ³¨äºæ™ºèƒ½åˆ›å»ºæ¨¡æ¿
   - çˆ¬è™«ç®¡ç†ï¼šä¸“æ³¨äºç®¡ç†å’Œæ‰§è¡Œ
3. **ä»£ç å¤ç”¨**ï¼šcrawlerAssistantService å¤ç”¨ crawlerService çš„åŠŸèƒ½

## ğŸ“ æ•°æ®åº“è¡¨ç»“æ„

```sql
-- çˆ¬è™«æ¨¡æ¿è¡¨ï¼ˆå…±äº«ï¼‰
crawler_templates
  â”œâ”€ id
  â”œâ”€ user_id
  â”œâ”€ name
  â”œâ”€ description
  â”œâ”€ url
  â”œâ”€ container_selector
  â””â”€ created_at/updated_at

-- æ¨¡æ¿å­—æ®µè¡¨ï¼ˆå…±äº«ï¼‰
crawler_template_fields
  â”œâ”€ id
  â”œâ”€ template_id
  â”œâ”€ field_name
  â””â”€ field_selector

-- å®šæ—¶ä»»åŠ¡è¡¨ï¼ˆçˆ¬è™«ç®¡ç†ä½¿ç”¨ï¼‰
crawler_tasks

-- é‡‡é›†ç»“æœè¡¨ï¼ˆçˆ¬è™«ç®¡ç†ä½¿ç”¨ï¼‰
crawler_results
crawler_result_rows
crawler_result_items
```

## ğŸ¯ ä½¿ç”¨æµç¨‹

### åœºæ™¯ 1ï¼šé€šè¿‡ AI åˆ›å»ºæ–°æ¨¡æ¿

1. ç”¨æˆ·åœ¨ "AI çˆ¬è™«åŠ©æ‰‹" ä¸­è¾“å…¥ç½‘å€å’Œéœ€æ±‚
2. AI åˆ†æç½‘é¡µç»“æ„ï¼Œç”Ÿæˆé€‰æ‹©å™¨
3. ç”¨æˆ·é¢„è§ˆæ•ˆæœï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒæ•´
4. ä¿å­˜æ¨¡æ¿ â†’ è°ƒç”¨ `crawlerService.saveTemplate()`
5. æ¨¡æ¿ä¿å­˜åˆ° `crawler_templates` è¡¨
6. åœ¨ "çˆ¬è™«ç®¡ç†" é¡µé¢å¯ä»¥çœ‹åˆ°æ–°åˆ›å»ºçš„æ¨¡æ¿

### åœºæ™¯ 2ï¼šåœ¨çˆ¬è™«ç®¡ç†ä¸­æ‰§è¡Œæ¨¡æ¿

1. ç”¨æˆ·åœ¨ "çˆ¬è™«ç®¡ç†" é¡µé¢æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿
2. é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿ï¼Œç‚¹å‡»"ç«‹å³æŠ“å–"
3. è°ƒç”¨ Python å¼•æ“æ‰§è¡Œçˆ¬å–
4. ç»“æœä¿å­˜åˆ° `crawler_results` è¡¨
5. å¯ä»¥åœ¨"é‡‡é›†è®°å½•"ä¸­æŸ¥çœ‹å†å²æ•°æ®

## ğŸ”§ æŠ€æœ¯å®ç°

### crawlerAssistantService (æ–°å¢)

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- `analyzeWebpage()` - AI åˆ†æç½‘é¡µç”Ÿæˆé€‰æ‹©å™¨
- `saveTemplate()` - ä¿å­˜æ¨¡æ¿ï¼ˆå†…éƒ¨è°ƒç”¨ crawlerServiceï¼‰
- `getUserTemplates()` - è·å–æ¨¡æ¿åˆ—è¡¨ï¼ˆè°ƒç”¨ crawlerServiceï¼‰
- `previewExtraction()` - é¢„è§ˆçˆ¬å–æ•ˆæœï¼ˆè°ƒç”¨ Python å¼•æ“ï¼‰

**å…³é”®ä»£ç ï¼š**
```typescript
// ä¿å­˜æ¨¡æ¿æ—¶è½¬æ¢æ ¼å¼
const fields = Object.entries(selectors.fields).map(([name, selector]) => ({
  name,
  selector: String(selector)
}));

await crawlerService.saveTemplate({
  userId,
  name,
  url,
  containerSelector,
  fields
});
```

### crawlerService (ç°æœ‰ï¼Œå·²ä¼˜åŒ–)

**åŠŸèƒ½ä¿æŒä¸å˜ï¼š**
- æ¨¡æ¿ CRUD æ“ä½œ
- å®šæ—¶ä»»åŠ¡ç®¡ç†
- æ•°æ®æŒä¹…åŒ–

**æ–°å¢ï¼š**
- è¢« crawlerAssistantService å¤ç”¨
- ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. åˆ›å»ºæ•°æ®åº“è¡¨

```bash
# æ–¹å¼ä¸€ï¼šè¿è¡Œå®Œæ•´åˆå§‹åŒ–
mysql -u root -p ai-data-platform < init.sql

# æ–¹å¼äºŒï¼šåªåˆ›å»ºçˆ¬è™«è¡¨
mysql -u root -p ai-data-platform < create_crawler_tables.sql
```

### 2. æ·»åŠ èœå•é¡¹

```bash
# æ·»åŠ  AI çˆ¬è™«åŠ©æ‰‹èœå•
mysql -u root -p ai-data-platform < setup_crawler_assistant.sql
```

### 3. é‡å¯æœåŠ¡

```bash
npm run dev
```

### 4. è®¿é—®é¡µé¢

- AI çˆ¬è™«åŠ©æ‰‹ï¼š`/ai/crawler-assistant`
- çˆ¬è™«ç®¡ç†ï¼š`/ai/crawler`

## âœ… æ•´åˆæ£€æŸ¥æ¸…å•

- [x] ä¸¤ä¸ªé¡µé¢å…±äº«åŒä¸€å¥—æ•°æ®åº“è¡¨
- [x] crawlerAssistantService å¤ç”¨ crawlerService
- [x] AI çˆ¬è™«åŠ©æ‰‹åˆ›å»ºçš„æ¨¡æ¿å¯åœ¨çˆ¬è™«ç®¡ç†ä¸­çœ‹åˆ°
- [x] çˆ¬è™«ç®¡ç†å¯ä»¥æ‰§è¡Œ AI åŠ©æ‰‹åˆ›å»ºçš„æ¨¡æ¿
- [x] Python å¼•æ“è¢«ä¸¤ä¸ªé¡µé¢å…±åŒä½¿ç”¨
- [x] æ•°æ®æŒä¹…åŒ–ä½¿ç”¨ EAV æ¨¡å¼

## ğŸ‰ ä¼˜åŠ¿

1. **é¿å…é‡å¤ä»£ç **ï¼šå¤ç”¨ç°æœ‰æœåŠ¡
2. **ç»Ÿä¸€æ•°æ®æº**ï¼šæ‰€æœ‰æ¨¡æ¿å­˜å‚¨åœ¨åŒä¸€ä½ç½®
3. **èŒè´£æ¸…æ™°**ï¼šAI åŠ©æ‰‹è´Ÿè´£åˆ›å»ºï¼Œçˆ¬è™«ç®¡ç†è´Ÿè´£æ‰§è¡Œ
4. **æ˜“äºç»´æŠ¤**ï¼šä¿®æ”¹ä¸€å¤„ï¼Œä¸¤å¤„ç”Ÿæ•ˆ
5. **ç”¨æˆ·ä½“éªŒå¥½**ï¼šæ™ºèƒ½åˆ›å»º + å¼ºå¤§ç®¡ç†

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

1. **åœ¨ AI åŠ©æ‰‹ä¸­æ·»åŠ å¿«æ·å…¥å£**
   - é¢„è§ˆæ•ˆæœåå¯ä»¥ç›´æ¥"å»çˆ¬è™«ç®¡ç†æ‰§è¡Œ"
   - åˆ›å»ºæ¨¡æ¿åå¯ä»¥"é…ç½®å®šæ—¶ä»»åŠ¡"

2. **åœ¨çˆ¬è™«ç®¡ç†ä¸­æ·»åŠ  AI åŠ©æ‰‹å…¥å£**
   - "åˆ›å»ºæ–°æ¨¡æ¿"æŒ‰é’®æ‰“å¼€ AI åŠ©æ‰‹
   - æ¨¡æ¿åˆ—è¡¨ä¸­æ·»åŠ "AI ä¼˜åŒ–"åŠŸèƒ½

3. **ç»Ÿä¸€æƒé™æ§åˆ¶**
   - ä½¿ç”¨åŒä¸€ä¸ªæƒé™ç³»ç»Ÿ
   - æ¨¡æ¿çš„åˆ›å»ºè€…æƒé™éªŒè¯

4. **å¢å¼º AI åˆ†æèƒ½åŠ›**
   - æ”¯æŒå¤šè½®å¯¹è¯è°ƒæ•´é€‰æ‹©å™¨
   - æ”¯æŒçˆ¬å–ç»“æœçš„æ™ºèƒ½åˆ†ç±»
   - è‡ªåŠ¨æ£€æµ‹ç½‘é¡µå˜åŒ–å¹¶æ›´æ–°é€‰æ‹©å™¨
